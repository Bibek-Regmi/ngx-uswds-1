<!-- 
  Script for updating css on theme change. The preview addon only updates
  styles in preview section's iframe. This script copies over the currently
  applied theme to main html anytime theme is changed for preview section
  through the theme selector
-->
<script defer>

  function deleteStyle() {
    var style = window.parent.document.head.querySelector('style#customTheme')
    window.parent.document.head.removeChild(style);
  }

  function addStyle() {
    var styles = document.head.getElementsByTagName('style');

    /** 
     * This makes an assumption that the theme style will 
     * be the last style tag in preview frame's head, and will fail if
     * that assumption is false
    **/
    var themeStyle = styles[styles.length - 1].innerHTML;
    var styleEl = document.createElement('style');
    styleEl.id = 'customTheme'
    styleEl.innerHTML = themeStyle;
    window.parent.document.head.appendChild(styleEl);
  }

  function listenForThemesChange() {
    const select = window.parent.document.body.querySelector('.os-content select');
    select.addEventListener('change', (event) => {
      setTimeout(() => {
        deleteStyle();
        addStyle();
      })
    });
  }

  window.addEventListener("load", function(){
    addStyle();
    listenForThemesChange();
    var contents = window.parent.document.getElementsByClassName('os-content');
    for (let i = 0; i < contents.length; i++) {
      if (i > 0) {
        contents[i].classList.add('bg-primary-darker')
      }
    }
  });
</script>